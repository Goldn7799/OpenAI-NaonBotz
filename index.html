<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
  <title>OpenAI - NaonBotz</title>
</head>
<body class="text-white">
  <style>
    body {
      background-color: rgb(39, 39, 39);
    }
    .queueLogList {
      background-color: rgb(44, 44, 44);
    }
    .centerPlus {
      display: flex;
      justify-content: center; /* mengatur posisi horizontal */
      align-items: center; /* mengatur posisi vertikal */
      height: 100vh;
    }
    .login {
      padding-left: 15px;
      padding-right: 15px;
      width: 400px;
      height: 400px;
      background-color: rgba(0, 132, 255, 0.568);
      border-radius: 5%;
    }
    .chatTime {
      text-align: right;
      margin-right: 5px;
      margin-bottom: -4px;
      color: gray;
    }
    .deleteQueue {
      margin-left: 10px;
    }
    .deleteQueue img {
      width: 20px;
      height: 20px;
    }
    .login h2 {
      margin-top: 5px;
      margin-bottom: 80px;
    }
    .login .item {
      margin-top: 50px;
    }
    .login .lockIcon {
      width: 100px;
      height: 100px;
      margin-top: -50px;
    }
    #chatlog {
      background-color: rgb(24, 24, 24);
      border-radius: 8px;
      width: 95%;
      height: 500px;
      overflow-y: scroll;
      scroll-behavior: smooth;
      text-align: left;
      padding-left: 10px;
      padding-top: 10px;
      padding-right: 5px;
    }
    #queuelog {
      margin-top: 5px;
      background-color: rgb(24, 24, 24);
      border-radius: 8px;
      width: 95%;
      height: 500px;
      overflow-y: scroll;
      scroll-behavior: smooth;
      text-align: left;
      padding-left: 10px;
      padding-top: 10px;
      padding-right: 5px;
    }
    .queueLogList {
      padding-top: 10px;
      padding-left: 10px;
      margin-bottom: 10px;
    }
    .queueLogList h5 {
      color: rgb(100, 100, 100);
    }
    #translog {
      margin-top: 5px;
      background-color: rgb(24, 24, 24);
      border-radius: 8px;
      width: 95%;
      height: 500px;
      overflow-y: scroll;
      scroll-behavior: smooth;
      text-align: left;
      padding-left: 10px;
      padding-top: 10px;
      padding-right: 5px;
    }
    .chatListChat h6 img {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      margin-right: 10px;
      margin-left: 5px;
    }
    .chatListChat {
      border-radius: 2px;
      padding-top: 8px;
      margin-bottom: 10px;
      padding-left: 2.5px;
      padding-bottom: 2.5px;
      margin-top: -16px;
      margin-left: 18px;
    }
    .arrow-right {
      width: 0;
      height: 0;
      border-top: 0px solid transparent;
      border-bottom: 16px solid transparent;
    }
    .quoted p b {
      color: lawngreen;
    }
    .quoted {
      padding-top: 5px;
      padding-left: 15px;
      border-left: 5px solid green;
      margin-left: 5px;
      margin-right: 5px;
      background-color: rgba(0, 0, 0, 0.199);
      border-radius: 5px;
    }
    .animated {
      transition: all ease-in-out 0.25s;
    }
  </style>
  <div id="root"></div>
  <script src="https://cdn.statically.io/gh/devanka761/notipin/v1.26.00/all.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe" crossorigin="anonymous"></script>
  <script type="module">
    const root = document.getElementById("root");
    let globalData = {
      api: "",
      password: "",
      db: {},
      chatList: {}
    }
    const page = {
      "login": ()=>{
        root.innerHTML = `
          <center class="centerPlus">
            <div class="login">
              <h2>Login</h2>
              <img class="lockIcon" src="https://cdn-icons-png.flaticon.com/512/272/272456.png" alt="Lock Icon">
              <div class="item">
                <div class="mb-3">
                  <div class="input-group">
                    <span class="input-group-text" id="basic-addon3">http://</span>
                    <input id="host" type="text" class="form-control" placeholder="Host" aria-label="Server" value="${window.location.href.replaceAll("/", "").split(":")[1]}">
                    <span class="input-group-text" id="basic-addon3">:</span>
                    <input id="port" type="text" class="form-control" placeholder="Port" aria-label="Server" value="${window.location.href.split(":")[2].split("/")[0]}">
                  </div>
                  </div>
                  <div class="input-group mb-3">
                    <div class="input-group-text">
                      <input id="showPassword" class="form-check-input mt-0" type="checkbox" value="" aria-label="Checkbox for following text input">
                    </div>
                    <input id="password" type="password" class="form-control" placeholder="Password" aria-label="Username" aria-describedby="basic-addon1">
                  </div>
                  <button id="loginButton" type="button" class="btn btn-warning">Login</button>
                </div>
              </div>
          </center>
        `;
        const host = document.getElementById("host");
        const port = document.getElementById("port");
        const password = document.getElementById("password");
        const showPassword = document.getElementById("showPassword");
        const loginButton = document.getElementById("loginButton");
        showPassword.addEventListener("click", ()=>{
          if(showPassword.checked){
            password.type = "text";
          }else {
            password.type = "password";
          }
        });
        loginButton.addEventListener("click", async ()=>{
          if(host.value.length > 0&&port.value.length > 0&&password.value.length > 0){
            const api = `http://${host.value}:${port.value}`;
            const login = await fetch(`${api}/data/${password.value}`, { method: "GET" })
            .then((ress) => {
              if(ress.status === 200){
                return ress.json();
              }else if(ress.status === 403){
                return false;
              }else {
                throw ress.status;
              }
            }).then((res) =>{
              if(res){
                return res;
              }else {
                Notipin.Alert({
                  msg: "Wrong Password", // Pesan kamu
                  yes: "Ok", // Tulisan di tombol 'Yes'
                  onYes: () => { /* Kode di sini */ },
                  type: "NORMAl",
                  mode: "DARK",
                });
                return false;
              }
            }).catch((err) => {
              Notipin.Alert({
                msg: `Error to fetch : ${err}`, // Pesan kamu
                yes: "Ok", // Tulisan di tombol 'Yes'
                onYes: () => { /* Kode di sini */ },
                type: "NORMAl",
                mode: "DARK",
              })
              return false;
            });
            if(login){
              globalData.api = api;
              globalData.password = password.value;
              page.home();
            };
          }else {
            Notipin.Alert({
              msg: "Please fill all items", // Pesan kamu
              yes: "Ok", // Tulisan di tombol 'Yes'
              onYes: () => { /* Kode di sini */ },
              type: "NORMAl",
              mode: "DARK",
            })
          }
        })
      },
      "home": ()=>{
        let isActived = true;
        root.innerHTML = `
          <div>
            <nav class="navbar bg-dark navbar-expand-lg bg-body-tertiary" data-bs-theme="dark">
              <div class="container-fluid">
                <a class="navbar-brand" href="#">NanBotz</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                  <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarSupportedContent">
                  <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item">
                      <a class="nav-link active" aria-current="page" href="#">Home</a>
                    </li>
                    <li class="nav-item">
                      <a class="nav-link" href="#">Link</a>
                    </li>
                    <li class="nav-item dropdown">
                      <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        Action Menu
                      </a>
                      <ul class="dropdown-menu">
                        <li><a class="dropdown-item" id="clearlog" href="#">Clear Logs</a></li>
                        <li><a class="dropdown-item" id="clearchatlog" href="#">Clear Chat Logs</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" id="setlimit" href="#">Set Limit</a></li>
                      </ul>
                    </li>
                    <li class="nav-item">
                      <a class="nav-link disabled" id="waInfo">Disabled</a>
                    </li>
                  </ul>
                </div>
              </div>
            </nav>
            <p>Ping : <b id="ping"></b> | Ram : <b id="ram"></b> | Node : <b id="node"></b> | Queue : <b id="queue"></b> | Limit : <b id="limit"></b> | Chat Logs : <b id="chatlogslength"></b> | Uptime : <b id="uptime"></b></p>
            <center><div id="chatlog"></div></center>
            <center><h4 style="margin-top: 15px;">Queue</h4><div id="queuelog"></div></center>
            <center><h4 style="margin-top: 15px;">Transaction Log</h4><div id="translog"></div></center>
          </div>
        `;
        document.getElementById("clearlog").addEventListener("click", ()=>{
          Notipin.Confirm({
            msg: "Do you want to clear logs?", // Pesan kamu
            yes: "Yes", // Tulisan di tombol 'Yes'
            no: "No", // Tulisan di tombol 'No'
            onYes: async () => {
              await fetch(`${globalData.api}/request/clearlog/${globalData.password}`, { method: "POST" })
              .then(rawRes => { return rawRes.json() })
              .then(res => {
                if (res.succes){
                  Notipin.Alert({
                    msg: "Succes deleting logs", // Pesan kamu
                    yes: "Ok", // Tulisan di tombol 'Yes'
                    onYes: () => {  },
                    type: "BLUE",
                    mode: "DARK",
                  })
                }else {
                  Notipin.Alert({
                    msg: "Failed deleting Logs", // Pesan kamu
                    yes: "Ok", // Tulisan di tombol 'Yes'
                    onYes: () => {  },
                    type: "INFO",
                    mode: "DARK",
                  })
                }
              }).catch(err => {
                Notipin.Alert({
                  msg: `${err}`, // Pesan kamu
                  yes: "Ok", // Tulisan di tombol 'Yes'
                  onYes: () => {  },
                  type: "DANGER",
                  mode: "DARK",
                })
              })
            },
            onNo: () => { /* Kode di sini */ },
            type: "INFO",
            mode: "DARK",
          })
        })
        document.getElementById("clearchatlog").addEventListener("click", ()=>{
          Notipin.Confirm({
            msg: "Do you want to clear chat logs?", // Pesan kamu
            yes: "Yes", // Tulisan di tombol 'Yes'
            no: "No", // Tulisan di tombol 'No'
            onYes: async () => {
              await fetch(`${globalData.api}/request/clearchatlog/${globalData.password}`, { method: "POST" })
              .then(rawRes => { return rawRes.json() })
              .then(res => {
                if (res.succes){
                  Notipin.Alert({
                    msg: "Succes deleting chat logs", // Pesan kamu
                    yes: "Ok", // Tulisan di tombol 'Yes'
                    onYes: () => {  },
                    type: "BLUE",
                    mode: "DARK",
                  })
                }else {
                  Notipin.Alert({
                    msg: "Failed deleting chat Logs", // Pesan kamu
                    yes: "Ok", // Tulisan di tombol 'Yes'
                    onYes: () => {  },
                    type: "INFO",
                    mode: "DARK",
                  })
                }
              }).catch(err => {
                Notipin.Alert({
                  msg: `${err}`, // Pesan kamu
                  yes: "Ok", // Tulisan di tombol 'Yes'
                  onYes: () => {  },
                  type: "DANGER",
                  mode: "DARK",
                })
              })
            },
            onNo: () => { /* Kode di sini */ },
            type: "INFO",
            mode: "DARK",
          })
        })
        document.getElementById("setlimit").addEventListener("click", ()=>{
          Notipin.Prompt({
            msg: "Set limit in $", // Pesan kamu
            placeholder: "1",
            max: 0, // Maksimal karakter (integer)
            textarea: false, // tag element (boolean)
            yes: "Ok", // Tulisan di tombol 'Yes'
            no: "Cancel", // Tulisan di tombol 'No'
            onYes: (res) => {
              if(res.length > 0&&parseFloat(res)){
                Notipin.Confirm({
                  msg: `Really to set limit <b>${res}$</b> ?`, // Pesan kamu
                  yes: "YES", // Tulisan di tombol 'Yes'
                  no: "NO", // Tulisan di tombol 'No'
                  onYes: async () => {
                    const ress = await fetch(`${globalData.api}/request/setlimit/${res}/${globalData.password}`, { method: "POST" })
                    .catch(err => {
                      Notipin.Alert({
                        msg: `${err}`, // Pesan kamu
                        yes: "Ok", // Tulisan di tombol 'Yes'
                        onYes: () => {  },
                        type: "DANGER",
                        mode: "DARK",
                      })
                    });
                    if(ress.status === 200){
                      Notipin.Alert({
                        msg: `Succes Changed`, // Pesan kamu
                        yes: "Ok", // Tulisan di tombol 'Yes'
                        onYes: () => {  },
                        type: "INFO",
                        mode: "DARK"
                      })
                    }else {
                      Notipin.Alert({
                        msg: `Failed to change`, // Pesan kamu
                        yes: "Ok", // Tulisan di tombol 'Yes'
                        onYes: () => {  },
                        type: "DANGER",
                        mode: "DARK",
                      })
                    }
                  },
                  onNo: () => { /* Kode di sini */ },
                  type: "BLUE",
                  mode: "DARK",
                })
              }else {
                Notipin.Alert({
                  msg: `Please fill input or use number only`, // Pesan kamu
                  yes: "Ok", // Tulisan di tombol 'Yes'
                  onYes: () => {  },
                  type: "DANGER",
                  mode: "DARK",
                })
              }
            },
            onNo: (res) => { /* Kode di sini */ },
            type: "BLUE",
            mode: "DARK",
          })
        })
        const colors = [
          "AliceBlue",
          "Beige",
          "Cornsilk",
          "FloralWhite",
          "Gainsboro",
          "GhostWhite",
          "HoneyDew",
          "Ivory",
          "Lavender",
          "LavenderBlush",
          "LemonChiffon",
          "LightBlue",
          "LightCoral",
          "LightCyan",
          "LightGoldenRodYellow",
          "LightGray",
          "LightGrey",
          "LightGreen",
          "LightPink",
          "LightSalmon",
          "LightSeaGreen",
          "LightSkyBlue",
          "LightSlateGray",
          "LightSlateGrey",
          "LightSteelBlue",
          "LightYellow",
          "MintCream",
          "MistyRose",
          "NavajoWhite",
          "OldLace",
          "PaleGoldenRod",
          "PaleGreen",
          "PaleTurquoise",
          "PaleVioletRed",
          "PapayaWhip",
          "PeachPuff",
          "SeaShell",
          "Snow",
          "WhiteSmoke",
          "Yellow",
          "YellowGreen"
        ];
        const getColor = ()=>{
          return colors[Math.floor(Math.random() * colors.length)];
        }
        const chatLogRoom = document.getElementById("chatlog");
        let chatColor = {};
        let currentChatList = ``;
        let currentQueueLog = `none`;
        // let isChatLogFirst = true;
        const getDB = async ()=>{
          const start = Date.now();
          const rawRes = await fetch(`${globalData.api}/data/${globalData.password}`).catch((err)=>{
            Notipin.Alert({
              msg: "Disconnected...", // Pesan kamu
              yes: "Ok", // Tulisan di tombol 'Yes'
              onYes: () => { window.location.reload(); },
              type: "DANGER",
              mode: "DARK",
            })
          });
          const res = await rawRes.json();
          if(rawRes.status === 200){
            globalData.db = res;
            let chats = ``;
            const end = Date.now();
            const pingTime = end - start;
            const uptimeInSeconds = res.os.uptime;
            const upHours = Math.floor(uptimeInSeconds / 3600);
            const upMinutes = Math.floor((uptimeInSeconds % 3600) / 60);
            const upSeconds = Math.floor(uptimeInSeconds % 60);
            document.getElementById("ping").innerText = pingTime + "Ms";
            document.getElementById("ram").innerText = `${(res.os.freemem / 1000000).toFixed(2)}MB Free of ${(res.os.totalmem / 1000000).toFixed(2)}MB`;
            document.getElementById("node").innerText = `${(res.os.nodemem / 1024 / 1024).toFixed(2)}MB`;
            document.getElementById('queue').innerText = `${res.queue.length}`;
            document.getElementById("uptime").innerText = `${upHours}H-${upMinutes}M-${upSeconds}S`;
            document.getElementById("chatlogslength").innerText = `${res.chatLog.length}`;
            document.getElementById("limit").innerText = `${res.os.limit.toFixed(4)}$`;
            const waInfo = document.getElementById("waInfo");
            let chatLog = ``;
            res.chatLog.map(item =>{
              if(!Object.keys(chatColor).includes(item.from)){
                chatColor[item.from] = `${getColor()}`;
              };
              if(item.author){
                if(!Object.keys(chatColor).includes(item.author)){
                  chatColor[item.author] = `${getColor()}`;
                };
              };
              const currentBackground =  `${(item.fromMe) ? "rgb(80, 80, 80)" : "rgb(44, 44, 44)"}`;
              const dateMsg = new Date(item.timestamp * 1000);
              const quotedName = (item.hasQuotedMsg&&item.quotedName) ? (item.quotedName).replaceAll("<", "&lt;").replaceAll(">", "&gt;") : false;
              const quotedBody = (item.hasQuotedMsg&&item.quotedBody) ? (item.quotedBody).replaceAll("<", "&lt;").replaceAll(">", "&gt;") : false;
              const mBody = (item.body) ? (item.body).replaceAll("<", "&lt;").replaceAll(">", "&gt;") : false;
              chatLog += `
                <span><div style="border-right: 18px solid ${currentBackground};" class="arrow-right"></div><div style="background-color: ${currentBackground};" class="chatListChat">
                  <h6><img src="https://static.vecteezy.com/system/resources/previews/008/442/086/original/illustration-of-human-icon-user-symbol-icon-modern-design-on-blank-background-free-vector.jpg" alt="user icon" /><span>${(item.fromMe) ? `<b style="color: lime;">BOT</b>` : item._data.notifyName}<b style="color: ${(item.author) ? chatColor[item.author] : chatColor[item.from]};">(~${(item.author) ? item.author : item.from})</b> <span style="color: yellowgreen;">from</span> ${item.chatName}<b style="color: ${chatColor[item.from]};">(${item.from})</b></span></h4>
                    ${(item.hasQuotedMsg) ? `
                    <div class="quoted">
                      <p><b>${quotedName}</b></p>
                      <p style="margin-top: -15px;">${(`${item.quotedBody}`.length > 0) ? `${(item._data.quotedMsg.type === "chat") ? "" : `<span style="color: orange;">${item._data.quotedMsg.type}</span> : `}${(`${item.quotedBody}`.length > 49) ? `${quotedBody.substring(0, 50)}....` : quotedBody}` : `<span style="color: orange;">${item._data.quotedMsg.type}</span>`}</p>
                    </div>
                    ` : ""}
                    <p style="margin-left: 15px;">${(item.type === "chat") ? mBody : `<b style="color: orange;">${item.type}</b>${(item.body.length > 0) ? ` : ${mBody}` : ""}`}</p>
                    <p class="chatTime">${dateMsg.getHours()}.${dateMsg.getMinutes()}</p>
                </div></span>
              `;
            })
            if(res.os.state !== "Disconnect"){
              waInfo.style.color = "lime";
              waInfo.innerText = "Connected";
            }else {
              waInfo.style.color = "red";
              waInfo.innerText = "Disconnected";
            }
            if(!chatLog.length > 0){
              if(res.os.state.includes("Loading")){
                const state = res.os.state.split(" ")[1].replace("%", "");
                chatLog = `
                  <center style="margin-top: 25px"><h3>${res.os.state}</h3>
                  <div style="width: 250px; height: 10px;" class="progress" role="progressbar" aria-label="Basic example" aria-valuenow="${state}" aria-valuemin="0" aria-valuemax="100">
                    <div class="progress-bar animated" style="width: ${state}%"></div>
                  </div></center>
                `;
              }else {
                chatLog = `<center style="margin-top: 25px"><h3>${res.os.state}</h3></center>`;
              }
            };
            if(currentChatList !== chatLog){
              currentChatList = chatLog;
              if (chatLogRoom.scrollTop + chatLogRoom.clientHeight >= chatLogRoom.scrollHeight){
                chatLogRoom.innerHTML = chatLog;
                chatLogRoom.scrollTop = chatLogRoom.scrollHeight;
              }else {
                chatLogRoom.innerHTML = chatLog;
              }
            };
            let queueLog = ``;
            res.queue.map(item => {
              const dateMsg = new Date(item.m.timestamp * 1000);
              const mBody = (item.m.body) ? (item.m.body).replaceAll("<", "&lt;").replaceAll(">", "&gt;") : false;
              const indexQueue = (res.queue.map(items => items.id)).indexOf(item.id);
              queueLog += `<div class="queueLogList">
                <h5><span style="color: yellowgreen;">${indexQueue + 1}.</span> ${item.id}(${item.queueType})${(indexQueue > 0) ? `<button onClick="deleteQueue('${item.id}')" class="btn btn-danger deleteQueue"><img src="https://cdn-icons-png.flaticon.com/512/1843/1843344.png" alt="Trash Can" /></button>` : ""}</h5>
                <p><span style="color: lime;">On </span>${item.senderContact.pushname}<b>(${item.senderContact.id._serialized})</b><span>From</span>${item.chat.name}<b>(${item.chat.id._serialized})</b></p>
                <p><span style="color: lime;">Request </span>${(item.m.type === "chat") ? mBody : `<b style="color: orange;">${item.m.type}</b>${(item.m.body.length > 0) ? ` : ${mBody}` : ""}`}</p>
                <p class="chatTime">${dateMsg.getHours()}.${dateMsg.getMinutes()}</p>
              </div>`
            })
            if(queueLog !== currentQueueLog){
              currentQueueLog = queueLog;
              if(queueLog.length > 0){
                document.getElementById("queuelog").innerHTML = queueLog;
              }else {
                document.getElementById("queuelog").innerHTML = `<center style="margin-top: 10px; color: rgb(100, 100, 100);"><h5>No Queues</h5></center>`;
              }
            };
            document.getElementById("translog").innerHTML = `<center style="margin-top: 10px; color: rgb(100, 100, 100);"><h5>Comming Soon</h5></center>`;
          }else {
            globalData.db = false;
          }
          setTimeout(() => {
            if(isActived){
              getDB();
            };
          }, 1000);
        };
        getDB();
      }
    }
    const deleteQueue = async (id)=>{
      Notipin.Confirm({
            msg: `Do you want to Delete Queue <b>${id}</b>?`, // Pesan kamu
            yes: "Yes", // Tulisan di tombol 'Yes'
            no: "No", // Tulisan di tombol 'No'
            onYes: async () => {
              const res = await fetch(`${globalData.api}/request/removequeue/${id}/${globalData.password}`, { method: "POST" }).catch(e => { return false; });
              if(await res?.status === 200){
                Notipin.Alert({
                  msg: "Succes Delete Queue", // Pesan kamu
                  yes: "Ok", // Tulisan di tombol 'Yes'
                  onYes: () => { /* Kode di sini */ },
                  type: "INFO",
                  mode: "DARK",
                });
              }else{
                Notipin.Alert({
                  msg: "Failed delete Queue", // Pesan kamu
                  yes: "Ok", // Tulisan di tombol 'Yes'
                  onYes: () => { /* Kode di sini */ },
                  type: "NORMAL",
                  mode: "DARK",
                });
              }
            },
            onNo: () => { /* Kode di sini */ },
            type: "BLUE",
            mode: "DARK",
          })
    }
    window.deleteQueue = deleteQueue;
    page.login()
  </script>
</body>
</html>